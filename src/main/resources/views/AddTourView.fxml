<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.image.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.shape.*?>
<?import javafx.scene.text.*?>
<?import javafx.scene.web.WebView?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.effect.*?>

<?import java.net.URL?>
<AnchorPane prefWidth="1200.0" prefHeight="800.0"
            xmlns="http://javafx.com/javafx/23.0.1"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="controllers.TourController">

    <!-- Dynamic Background with Overlay -->
    <StackPane AnchorPane.topAnchor="0.0" AnchorPane.bottomAnchor="0.0"
               AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0">
        <!-- Background Image -->
        <ImageView fitHeight="800.0" fitWidth="1200.0" pickOnBounds="true" preserveRatio="false">
            <image>
                <Image url="/photos/background.jpg" />
            </image>
            <effect>
                <GaussianBlur radius="5.0" />
            </effect>
        </ImageView>

        <!-- Semi-transparent overlay -->
        <Rectangle width="1200.0" height="800.0" fill="#012e4155" />
    </StackPane>

    <!-- Page Header -->
    <HBox alignment="CENTER_LEFT" spacing="10" AnchorPane.topAnchor="15.0" AnchorPane.leftAnchor="20.0">
        <!-- Back Button -->
        <Button onAction="#handleBackButtonClick" styleClass="back-button">
            <graphic>
                <ImageView fitHeight="24.0" fitWidth="24.0" pickOnBounds="true" preserveRatio="true">
                    <image>
                        <Image url="@../photos/arrow.png" />
                    </image>
                </ImageView>
            </graphic>
            <style>
                -fx-background-color: white;
                -fx-background-radius: 30;
                -fx-padding: 8;
            </style>
            <effect>
                <DropShadow color="#00000066" radius="5.0" spread="0.05" />
            </effect>
        </Button>

        <!-- Page Title -->
        <Label text="Create New Tour Package" style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: white;">
            <effect>
                <DropShadow />
            </effect>
        </Label>
    </HBox>

    <!-- Main Content Container -->
    <ScrollPane AnchorPane.topAnchor="70.0" AnchorPane.leftAnchor="30.0" AnchorPane.rightAnchor="30.0"
                AnchorPane.bottomAnchor="30.0" fitToWidth="true" style="-fx-background: transparent; -fx-background-color: transparent;">
        <VBox spacing="20">
            <!-- Tour Details and Activities Section -->
            <HBox spacing="25">
                <!-- Left Section: Tour Details -->
                <VBox spacing="15" styleClass="card" prefWidth="550">
                    <!-- Card Header -->
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <ImageView fitHeight="30.0" fitWidth="30.0">
                            <image>
                                <Image url="@../photos/tour-icon.png" /> <!-- Replace with appropriate icon -->
                            </image>
                        </ImageView>
                        <Label text="Tour Details" styleClass="card-title" />
                    </HBox>

                    <Separator />

                    <!-- Tour Image Preview -->
                    <VBox spacing="10" alignment="CENTER">
                        <StackPane style="-fx-background-color: #f5f5f5; -fx-background-radius: 8;">
                            <ImageView fx:id="imageView" fitHeight="200" fitWidth="500" preserveRatio="true" />
                            <Label fx:id="noImageLabel" text="No Image Selected" visible="true"
                                   style="-fx-text-fill: #888888; -fx-font-style: italic;" />
                        </StackPane>
                        <Button text="Upload Tour Image" onAction="#handleSelectImage" styleClass="action-button">
                            <graphic>
                                <ImageView fitHeight="16.0" fitWidth="16.0">
                                    <image>
                                        <Image url="@../photos/upload-icon.png" /> <!-- Replace with appropriate icon -->
                                    </image>
                                </ImageView>
                            </graphic>
                        </Button>
                    </VBox>

                    <!-- Tour Details Form -->
                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints prefWidth="150" />
                            <ColumnConstraints prefWidth="350" />
                        </columnConstraints>

                        <!-- Tour Title -->
                        <Label text="Title:" styleClass="form-label" GridPane.rowIndex="0" GridPane.columnIndex="0" />
                        <TextField fx:id="titleField" promptText="Enter a memorable tour title"
                                   styleClass="form-field" GridPane.rowIndex="0" GridPane.columnIndex="1" />

                        <!-- Tour Type -->
                        <Label text="Tour Type:" styleClass="form-label" GridPane.rowIndex="1" GridPane.columnIndex="0" />
                        <ComboBox fx:id="typeComboBox" promptText="Select tour type"
                                  styleClass="form-field" GridPane.rowIndex="1" GridPane.columnIndex="1" />

                        <!-- Tour Location -->
                        <Label text="Location:" styleClass="form-label" GridPane.rowIndex="2" GridPane.columnIndex="0" />
                        <TextField fx:id="locationField" promptText="Main destination of the tour"
                                   styleClass="form-field" GridPane.rowIndex="2" GridPane.columnIndex="1" />

                        <!-- Tour Date -->
                        <Label text="Date:" styleClass="form-label" GridPane.rowIndex="3" GridPane.columnIndex="0" />
                        <DatePicker fx:id="dateField" promptText="Select tour date"
                                    styleClass="form-field" GridPane.rowIndex="3" GridPane.columnIndex="1" />

                        <!-- Tour Price -->
                        <Label text="Price:" styleClass="form-label" GridPane.rowIndex="4" GridPane.columnIndex="0" />
                        <HBox spacing="10" alignment="CENTER_LEFT" GridPane.rowIndex="4" GridPane.columnIndex="1">
                            <TextField fx:id="priceField" promptText="0.00" styleClass="form-field" prefWidth="150" />
                            <Label text="USD" style="-fx-text-fill: #666666;" />
                        </HBox>

                        <!-- Available Places -->
                        <Label text="Available Places:" styleClass="form-label" GridPane.rowIndex="5" GridPane.columnIndex="0" />
                        <Spinner fx:id="nbPlaceDisponibleField" min="1" max="500" initialValue="10"
                                 styleClass="form-field" editable="true" GridPane.rowIndex="5" GridPane.columnIndex="1" />

                        <!-- Tour Description -->
                        <Label text="Description:" styleClass="form-label" GridPane.rowIndex="6" GridPane.columnIndex="0" GridPane.valignment="TOP" />
                        <TextArea fx:id="descriptionField" promptText="Provide a detailed description of the tour experience"
                                  styleClass="form-field" prefRowCount="5" wrapText="true"
                                  GridPane.rowIndex="6" GridPane.columnIndex="1" />
                    </GridPane>
                </VBox>

                <!-- Right Section: Activities -->
                <VBox spacing="15" styleClass="card" prefWidth="550">
                    <!-- Card Header -->
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <ImageView fitHeight="30.0" fitWidth="30.0">
                            <image>
                                <Image url="@../photos/activities-icon.png" /> <!-- Replace with appropriate icon -->
                            </image>
                        </ImageView>
                        <Label text="Tour Activities" styleClass="card-title" />
                    </HBox>

                    <Separator />

                    <!-- Activities List -->
                    <VBox spacing="10">
                        <Label text="Added Activities" styleClass="section-title" />
                        <StackPane>
                            <ListView fx:id="activityListView" prefHeight="150" styleClass="activity-list" />
                            <Label fx:id="noActivitiesLabel" text="No activities added yet" visible="true"
                                   style="-fx-text-fill: #888888; -fx-font-style: italic;" />
                        </StackPane>
                    </VBox>

                    <!-- Activity Form -->
                    <TitledPane text="Add New Activity" expanded="false" styleClass="titled-pane">
                        <content>
                            <VBox spacing="15">
                                <!-- Activity Details Form -->
                                <GridPane hgap="15" vgap="15">
                                    <columnConstraints>
                                        <ColumnConstraints prefWidth="150" />
                                        <ColumnConstraints prefWidth="300" />
                                    </columnConstraints>

                                    <!-- Activity Name -->
                                    <Label text="Activity Name:" styleClass="form-label" GridPane.rowIndex="0" GridPane.columnIndex="0" />
                                    <TextField fx:id="activityNameField" promptText="Enter activity name"
                                               styleClass="form-field" GridPane.rowIndex="0" GridPane.columnIndex="1" />

                                    <!-- Activity Location -->
                                    <Label text="Location:" styleClass="form-label" GridPane.rowIndex="1" GridPane.columnIndex="0" />
                                    <TextField fx:id="activityLocationField" promptText="Activity location"
                                               styleClass="form-field" GridPane.rowIndex="1" GridPane.columnIndex="1" />

                                    <!-- Activity Dates -->
                                    <Label text="Duration:" styleClass="form-label" GridPane.rowIndex="2" GridPane.columnIndex="0" />
                                    <HBox spacing="10" GridPane.rowIndex="2" GridPane.columnIndex="1">
                                        <DatePicker fx:id="activityStartDateField" promptText="Start" styleClass="form-field" />
                                        <Label text="to" style="-fx-text-fill: #666666;" />
                                        <DatePicker fx:id="activityEndDateField" promptText="End" styleClass="form-field" />
                                    </HBox>

                                    <!-- Activity Description -->
                                    <Label text="Description:" styleClass="form-label" GridPane.rowIndex="3" GridPane.columnIndex="0" GridPane.valignment="TOP" />
                                    <TextArea fx:id="activityDescriptionField" promptText="Describe what participants will experience"
                                              styleClass="form-field" prefRowCount="3" wrapText="true"
                                              GridPane.rowIndex="3" GridPane.columnIndex="1" />
                                </GridPane>

                                <!-- Activity Image -->
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <ImageView fx:id="activityImageView" fitHeight="80" fitWidth="120"
                                               style="-fx-background-color: #f5f5f5; -fx-background-radius: 4;" />
                                    <Button text="Select Activity Image" onAction="#handleSelectActivityImage" styleClass="secondary-button" />
                                </HBox>

                                <!-- Add Activity Button -->
                                <Button text="Add to Tour" onAction="#handleAddActivity" styleClass="primary-button">
                                    <graphic>
                                        <ImageView fitHeight="16.0" fitWidth="16.0">
                                            <image>
                                                <Image url="@../photos/plus-icon.png" /> <!-- Replace with appropriate icon -->
                                            </image>
                                        </ImageView>
                                    </graphic>
                                </Button>
                            </VBox>
                        </content>
                    </TitledPane>
                </VBox>
            </HBox>

            <!-- Street View Section -->
            <VBox spacing="15" styleClass="card">
                <!-- Card Header -->
                <HBox alignment="CENTER_LEFT" spacing="10">
                    <ImageView fitHeight="30.0" fitWidth="30.0">
                        <image>
                            <Image url="@../photos/map-icon.png" /> <!-- Replace with appropriate icon -->
                        </image>
                    </ImageView>
                    <Label text="360° Street View Preview" styleClass="card-title" />
                </HBox>

                <Separator />

                <!-- Street View Content -->
                <HBox spacing="15">
                    <VBox spacing="10" prefWidth="300">
                        <Label text="Enter location to preview:" styleClass="form-label" />
                        <TextField fx:id="streetViewLocationField" promptText="Search for a location" styleClass="form-field" />
                        <Button text="Load Street View" fx:id="loadStreetViewButton" styleClass="primary-button" />
                    </VBox>

                    <WebView fx:id="streetViewWebView" prefWidth="800" prefHeight="300" />
                </HBox>
            </VBox>

            <!-- Action Buttons -->
            <HBox spacing="15" alignment="CENTER_RIGHT">
                <Button text="Cancel" styleClass="cancel-button" />
                <Button text="Save Draft" styleClass="secondary-button" />
                <Button text="Create Tour" onAction="#handleAddTour" styleClass="submit-button">
                    <graphic>
                        <ImageView fitHeight="16.0" fitWidth="16.0">
                            <image>
                                <Image url="@../photos/check-icon.png" /> <!-- Replace with appropriate icon -->
                            </image>
                        </ImageView>
                    </graphic>
                </Button>
            </HBox>
        </VBox>
    </ScrollPane>

    <!-- CSS Styles -->
    <stylesheets>
        <URL value="@tourstyle.css" />
    </stylesheets>
</AnchorPane>